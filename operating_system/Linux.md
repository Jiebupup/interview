## 简介

严格来讲，Linux 这个词本身只表示 Linux 内核。

Linux 商业-社区发行版：Red Hat - CentOS，Ubuntu - Debian。

**包管理工具**

RPM

YUM 基于 RPM，具有依赖管理和软件升级功能。

**GPL**

GNU 通用公共许可协议：以任何目的运行此程序的自由。再复制的自由。改进此程序，并公开发布改进的自由。



## 1.常用操作

sudo 允许一般用户使用 root 可执行的命令，不过只有在 /etc/sudoers 配置文件中添加的用户才能使用该指令。

**求助**

--help：指令的基本用法与选项介绍。

man：将指令的具体信息显示出来。

info：与 man 类似，但是 info 将文档分成一个个页面，每个页面可以进行跳转。

doc：/usr/share/doc 存放着软件的一整套说明文件。

**关机**

shutdown：关机。

who：查看有没有其它用户在线。

sync：为了加快对磁盘文件的读写速度，位于内存中的文件数据不会立即同步到磁盘上，因此关机之前需要先进行 sync 同步操作。

reboot：重开机。

**压缩和打包**

压缩：gzip，bzip2，xz。

打包：tar。打包并压缩 tar -zcvf，解压 tar -xvf。

**完整备份与恢复**

dump 和 restore。





## 2.文件

Linux 系统一切都是文件。

**索引节点 inode**

一个文件占用一个 inode，记录文件的属性，同时记录此文件的内容所在的 block 编号。

stat：查看文件的 inode 信息。

**块 block**

存储文件的内容，由多个 sector 组成。一个文件可能会占用多个 block，但是一个 block 只能存放一个文件。因为数据是由 inode 指向的，如果有两个文件的数据存放在同一个块中，就会乱套了。未使用的部分直接浪费，因此如果需要存储大量的小文件，那么最好选用比较小的 block。

superblock：记录文件系统的整体信息。

block bitmap：记录 block 是否被使用的位图。

磁盘碎片：指一个文件内容所在的 block 过于分散，导致磁盘磁头移动距离过大，从而降低磁盘读写性能。

**扇区 sector**

硬盘的最小存储单位。

**文件系统**

Ext2 和 FAT。

对分区进行格式化是为了在分区上建立文件系统。一个分区通常只能格式化为一个文件系统，但是磁盘阵列等技术可以将一个分区格式化为多个文件系统。

对于 Ext2 文件系统，当要读取一个文件的内容时，先在 inode 中查找文件内容所在的所有 block，然后把所有 block 的内容读出来。

而对于 FAT 文件系统，它没有 inode，每个 block 中存储着下一个 block 的编号。

ext3/ext4 文件系统引入了日志功能，可以利用日志来修复文件系统。

**目录**

建立一个目录时，会分配一个 inode 与至少一个 block。block 记录的内容是目录下所有文件的 inode 编号以及文件名。

可以看到文件的 inode 本身不记录文件名，文件名记录在目录中，因此新增文件、删除文件、更改文件名这些操作与目录的写权限有关。

挂载利用目录作为文件系统的进入点，也就是说，进入目录之后就可以读取文件系统的数据。

#### 文件类型

普通文件 -：用于存储信息和数据， Linux 用户可以根据访问权限对普通文件进行查看、更改、删除。

目录文件 d：目录也是文件的一种，用于表示和管理系统中的文件，目录文件中包含一些文件名和子目录名。打开目录事实上就是打开目录文件。：

链接文件 l：保留了指向文件的地址而不是文件本身。

字符设备 c：用来访问字符设备比如硬盘。

设备文件 b：用来访问块设备比如硬盘、软盘。

管道文件 p：一种特殊类型的文件，用于进程之间的通信。

套接字文件 s：用于进程间的网络通信，也可以用于本机之间的非网络通信。

#### 基本操作

ls：列出文件或者目录的信息，目录的信息就是其中包含的文件。ll 是 ls -l 的别名，ll 命令可以看到该目录下的所有目录和文件的详细信息。

cp、rm 和 mv：复制、删除和移动（重命名）文件或目录。

cat：取得文件内容。

more：和 cat 不同的是它可以一页一页查看文件内容，比较适合大文件的查看。

less：和 more 类似，多了一个向前翻页的功能。

head：只看文件的头几行。

tail：只看文件的最后几行。用来看日志信息。

touch：修改文件时间或者建立新文件。

vim：编辑文件内容。分为一般模式、编辑模式、命令行模式。i，ESC，:wq。

file：查看文件类型。

which：指令搜索。

whereis、locate 和 find：文件搜索。whereis 和 locate 到数据库文件去查找，而不实际查找文件系统。find 直接查询文件系统。

ln：实体链接，删除任意一个条目，文件还是存在。符号链接，当源文件被删除了，链接文件就打不开了。

chmod：修改权限 rwx。文件类型、所有者 u、所在组 g、其它组 o。超级用户可以无视普通用户的权限，即使文件目录权限是 000，依旧可以访问。文件默认权限 666，目录默认权限 777。

**文件和目录权限的区别**

r：文件可以使用 cat 查看文件的内容，目录可以查看目录下列表。

w：文件可以修改文件的内容，目录可以创建和删除目录下文件。

x：文件可以将其运行为二进制文件，目录可以使用 cd 进入目录。



## 3.目录

Linux 目录配置标准 FHS：/bin，/dev...

绝对路径和相对路径

目录树：所有可操作的计算机资源都存在于目录树这个结构中，对计算资源的访问，可以看做是对这棵目录树的访问。

#### 常见目录

/bin：存放二进制可执行文件（ls、cat、mkdir 等），常用命令一般都在这里。

/etc：存放系统管理和配置文件。

/home：存放所有用户文件的根目录，是用户主目录的基点，比如用户 user 的主目录就是/home/user，可以用 ~user 表示。

/usr ：用于存放系统应用程序。

/opt：额外安装的可选应用程序包所放置的位置。一般情况下，我们可以把 tomcat 等都安装到这里。

/proc：虚拟文件系统目录，是系统内存的映射。可直接访问这个目录来获取系统信息。

/root：系统管理员的主目录。

/sbin：存放二进制可执行文件，只有 root 才能访问。这里存放的是系统管理员使用的系统级别的管理命令和程序，如 ifconfig 等。

/dev：用于存放设备文件。

/mnt：系统管理员安装临时文件系统的安装点，系统提供这个目录是让用户临时挂载其他的文件系统。

/boot：存放用于系统引导时使用的各种文件。

/lib：存放着和系统运行相关的库文件。

/tmp：用于存放各种临时文件，是公用的临时文件存储点。

/var：用于存放运行时需要改变数据的文件，也是某些大文件的溢出区，比如各种服务（如系统启动）的日志文件。

/lost+found：这个目录平时是空的，系统非正常关机而留下无家可归的文件就在这里。

#### 基本操作

cd：更换目录。上一层目录 .. 或 ../，系统根目录 /，用户主目录 ~，上一个操作所在目录 -。

pwd：显示当前目录。

mkdir 和 rmdir：创建和删除目录。

df 和 du：目录和磁盘的容量。

find：查找目录。



## 4.磁盘

**基本输入输出系统 BIOS**

是开机的时候计算机执行的第一个程序，知道可以开机的磁盘，并读取磁盘第一个扇区的主要开机记录 MBR，由 MBR 执行其中的开机管理程序，这个开机管理程序会加载操作系统的核心文件。

**基本操作**

fdisk：磁盘分区。

mkfs：文件系统格式化。

fsck 和 badblocks：磁盘检验。

mount：磁盘挂载。

mknod：磁盘参数修改。



## 5.Bash

可以通过 shell 请求内核提供服务，bash 正是 shell 的一种。

shell 是内核和硬件的接口。

环境变量 PATH：声明可执行文件的路径，路径之间用 : 分隔。

自定义变量

数据流重定向：输出 > 和 >>。

管道命令：一个命令的输出作为另一个命令的输入 ｜。

shell script

grep&printf&awk

#### 基本操作

type：判断命令是否为 bash 内置命令。

echo：显示变量。

set：查看变量。

alias：命令别名设置。

history：历史命令。



## 6.进程管理

进程状态

SIGCHLD 信号

#### 基本操作

ps：查看某个时间点的进程信息。

kill：杀死进程。kill -9 强制终止。

pstree：查看进程树。

top：实时显示进程信息。

netstat：查看占用端口的进程。

#### 孤儿进程

一个父进程退出，而它的一个或多个子进程还在运行，那么这些子进程将成为孤儿进程。

孤儿进程将被 init 进程（进程号为 1）所收养，并由 init 进程对它们完成状态收集工作。

孤儿进程不会对系统造成危害。

#### 僵尸进程

如果子进程退出，而父进程并没有调用 wait() 或 waitpid()，那么子进程的进程描述符仍然保存在系统中，这种进程称之为僵尸进程。

系统所能使用的进程号是有限的，如果产生大量僵尸进程，将因为没有可用的进程号而导致系统不能产生新的进程。

要消灭系统中大量的僵尸进程，只需要将其父进程杀死，此时僵尸进程就会变成孤儿进程。

**cpu 占用高如何排查？**              

1. top 命令找到 cpu 占用高的进程 PID。
2. ps 命令/top -p 命令，查询进程中 cpu 占用高的线程 TID。
3. jstack 命令打印线程日志，TID 转化为十六进制后，在线程日志中查找。

​              

## 7.网络

Linux 系统上查看项目的运行状态：查看日志和进程运行情况。

#### 基本操作

ifconfig：查看当前系统的网卡信息。

ping：查看与某台机器的连接情况。

telnet：查看某个端口是否可访问。

scp：远程单个复制 。

sftp：文件传输。

**namespace**

是 Linux 内核用来隔离内核资源的方式。

使得处于不同 namespace 的进程拥有独立的全局系统资源，通过 namespace 可以让一些进程只能看到与自己相关的一部分资源，其他 namespace 内的进程不可见。

Linux 内核实现 namespace 的一个主要目的就是实现轻量级虚拟化 (容器) 服务。为 docker 等容器技术的出现和发展提供了基础条件。

**Linux 删除正在进行读写操作的文件**

当用户执行 rm 操作后，ls 或者其他文件管理命令不再能够找到这个文件，但是进程却依然在继续正常执行，依然能够从文件中正确的读取内容。

每个文件都有 2 个 link 计数器 —— i_count 和 i_nlink。i_count 的意义是当前使用者的数量，i_nlink 的意义是介质连接的数量。或者可以理解为 i_count 是内存引用计数器，i_nlink 是硬盘引用计数器。再换句话说，当文件被某个进程引用时，i_count 就会增加；当创建文件的硬连接的时候，i_nlink 就会增加。

rm 操作只是将 i_nlink 置为 0 了。由于文件被进程引用的缘故，i_count 不为 0。